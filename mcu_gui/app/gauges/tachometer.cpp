#include "tachometer.h"
#include <vector>

using namespace McuGui;

void
TachometerTyp1::paint(PainterInterface& painter) const {
    // this is tach rectangles position.
    // height is 18, gap is 2
    static const std::vector<std::vector<Position>> rect_pos = {
        {{6, 218}, {39, 218}, {8, 202}, {41, 202}},
        {{8, 200}, {41, 200}, {10, 184}, {43, 184}},
        {{10, 182}, {43, 182}, {12, 166}, {45, 166}}, // 1000
        {{12, 164}, {45, 164}, {14, 148}, {47, 148}},
        {{14, 146}, {47, 146}, {16, 130}, {49, 130}},
        {{16, 128}, {49, 128}, {18, 112}, {51, 112}}, // 2000
        {{18, 110}, {51, 110}, {20, 94}, {53, 94}},
        {{20, 92}, {53, 92}, {22, 76}, {55, 76}},
        {{22, 74}, {55, 74}, {24, 58}, {57, 58}}, // 3000
        {{24, 56}, {57, 56}, {35, 31}, {64, 42}},
        {{37, 29}, {65, 41}, {61, 9}, {76, 32}},
        {{64, 8}, {80, 33}, {94, 6}, {94, 31}}, // 4000
        {{96, 6}, {96, 32}, {114, 6}, {114, 32}},
        {{116, 6}, {116, 32}, {134, 6}, {134, 32}},
        {{136, 6}, {136, 32}, {154, 6}, {154, 32}}, // 5000
        {{156, 6}, {156, 32}, {174, 6}, {174, 32}},
        {{176, 6}, {176, 32}, {194, 6}, {194, 32}},
        {{196, 6}, {196, 32}, {214, 6}, {214, 32}}, // 6000
        {{216, 6}, {216, 32}, {234, 6}, {234, 32}},
        {{236, 6}, {236, 32}, {254, 6}, {254, 32}},
        {{256, 6}, {256, 32}, {274, 6}, {274, 32}}, // 7000
        {{276, 6}, {276, 32}, {294, 6}, {294, 32}},
        {{296, 6}, {296, 32}, {314, 6}, {314, 32}},
        {{316, 6}, {316, 32}, {334, 6}, {334, 32}}, // 8000
        {{336, 6}, {336, 32}, {354, 6}, {354, 32}},
        {{356, 6}, {356, 32}, {374, 6}, {374, 32}},
        {{376, 6}, {376, 32}, {394, 6}, {394, 32}}, // 9000
        {{396, 6}, {396, 32}, {414, 6}, {414, 32}},
        {{416, 6}, {416, 32}, {434, 6}, {434, 32}},
        {{436, 6}, {436, 32}, {454, 6}, {454, 32}} // 10000
    };
    painter.setPen(COLOR_ORANGE);
    size_t rects = (size_t)(value_/333);
    for(size_t i = 0; i < rects; ++i) {
        if(rect_pos.size() > i) {
            auto rect = rect_pos[i];
            if (i >= 27 and i <= 28) painter.setPen(COLOR_YELLOW);
            if (i == 29) painter.setPen(COLOR_RED);
            painter.drawTriangle(rect[0], rect[1], rect[2]);
            painter.drawTriangle(rect[1], rect[2], rect[3]);
        }
    }
    painter.drawBitmap({4, 2}, bgrnd_);
}

void
TachometerTyp1::setValue(uint16_t value) {
    if (value > 10000) value_ = 10000;
    else value_ = value;
}
